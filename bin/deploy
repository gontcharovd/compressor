#!/usr/bin/env bash
location=westeurope
backendResourceGroupName=compressorBackend
frontendResourceGroupName=compressorFrontend

dir=/home/denis/code/compressor

echo "Loading secrets from .env file"
export $(grep -v '^#' ${dir}/secrets.env | xargs -0)

az account set --name compressor

echo "Creating backend resource group"
az group create --location $location --resource-group $backendResourceGroupName

echo "Creating frontend resource group"
az group create --location $location --resource-group $frontendResourceGroupName

echo "Deploying resources"
az deployment group create \
    --resource-group $backendResourceGroupName \
    --template-file ${dir}/main.bicep \
    --parameters \
        frontendResourceGroupName=$frontendResourceGroupName \
        cogniteClientIDValue=${CLIENT_ID} \
        cogniteClientSecretValue=${CLIENT_SECRET} \
        cogniteTenantIDValue=${TENANT_ID} \
        postgresUserValue=${POSTGRES_USER} \
        postgresPasswordValue=${POSTGRES_PASSWORD} \
